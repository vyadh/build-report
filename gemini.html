<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Build Report</title>
    <style>
        :root {
            --primary-bg-color: #1e1e1e;
            --secondary-bg-color: #2a2a2a;
            --tertiary-bg-color: #333333;
            --primary-text-color: #e0e0e0;
            --secondary-text-color: #b0b0b0;
            --accent-color: #00aaff;
            --link-color: #00aaff;
            --link-hover-color: #0088cc;
            --border-color: #444444;
            --success-color: #28a745;
            --error-color: #dc3545;
            --warning-color: #ffc107;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --card-padding: 20px;
            --card-border-radius: 8px;
            --section-spacing: 25px;
        }

        body.build-report-body {
            background-color: var(--primary-bg-color);
            color: var(--primary-text-color);
            font-family: var(--font-family);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        .build-report-container {
            background-color: var(--secondary-bg-color);
            border: 1px solid var(--border-color);
            border-radius: var(--card-border-radius);
            padding: var(--card-padding);
            margin: 20px; /* Provides spacing if embedded directly on a similar bg */
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .report-header {
            text-align: center;
            margin-bottom: var(--section-spacing);
            padding-bottom: var(--section-spacing);
            border-bottom: 2px solid var(--accent-color);
        }

        .report-header h1 {
            font-size: 2.5em;
            color: var(--accent-color);
            margin: 0 0 10px 0;
        }

        .report-header .app-name {
            font-size: 1.8em;
            color: var(--primary-text-color);
            margin-top: 0;
        }

        .report-section {
            margin-bottom: var(--section-spacing);
            background-color: var(--tertiary-bg-color);
            padding: var(--card-padding);
            border-radius: var(--card-border-radius);
        }

        .report-section h2 {
            font-size: 1.5em;
            color: var(--accent-color);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .property-item {
            background-color: var(--secondary-bg-color);
            padding: 15px;
            border-radius: var(--card-border-radius);
            border: 1px solid var(--border-color);
            word-break: break-word; /* Prevents long strings from breaking layout */
        }

        .property-item strong {
            display: block;
            color: var(--primary-text-color);
            margin-bottom: 5px;
            font-size: 0.95em;
        }

        .property-item span, .property-item a {
            color: var(--secondary-text-color);
            font-size: 0.9em;
        }

        .property-item a {
            color: var(--link-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .property-item a:hover {
            color: var(--link-hover-color);
            text-decoration: underline;
        }

        .prominent {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--primary-text-color);
        }

        .optional-item {
            opacity: 0.8;
        }

        .status-protected {
            color: var(--success-color);
            font-weight: bold;
        }
        .status-unprotected {
            color: var(--warning-color);
            font-weight: bold;
        }

        .artefacts-list {
            list-style: none;
            padding: 0;
        }

        .artefacts-list li {
            background-color: var(--secondary-bg-color);
            padding: 10px 15px;
            border-radius: var(--card-border-radius);
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .artefacts-list .artefact-name {
            font-weight: bold;
            color: var(--primary-text-color);
        }
        .artefacts-list .artefact-type {
            font-style: italic;
            color: var(--secondary-text-color);
            margin-left: 10px;
        }
        .artefacts-list a {
            color: var(--link-color);
            text-decoration: none;
            margin-left: auto; /* Pushes link to the right */
            padding-left: 15px; /* Space before link */
        }
        .artefacts-list a:hover {
            color: var(--link-hover-color);
            text-decoration: underline;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .report-header h1 {
                font-size: 2em;
            }
            .report-header .app-name {
                font-size: 1.5em;
            }
            .grid-container {
                grid-template-columns: 1fr; /* Stack items on smaller screens */
            }
            .artefacts-list li {
                flex-direction: column;
                align-items: flex-start;
            }
            .artefacts-list a {
                margin-left: 0;
                margin-top: 5px;
                padding-left: 0;
            }
        }

        /* Ensure self-contained visual distinctness */
        .build-report-container.embedded {
            box-shadow: 0 0 15px rgba(0, 170, 255, 0.2); /* Subtle glow in accent color */
            border: 1px solid var(--accent-color);
        }

    </style>
</head>
<body class="build-report-body">

<div class="build-report-container embedded"> <header class="report-header">
    <h1><span id="projectName">Hello World</span></h1>
    <p class="app-name"><span id="applicationName">Samples</span></p>
    <p class="optional-item" id="projectDescriptionContainer" style="display: none;">
        Description: <span id="projectDescription">The hello world service</span>
    </p>
</header>

    <section class="report-section">
        <h2>Build & Version</h2>
        <div class="grid-container">
            <div class="property-item" id="versionContainer" style="display: none;"> <strong>Version:</strong>
                <a href="#" id="versionLink" target="_blank" class="prominent"><span id="version">1.2.3</span></a>
            </div>
            <div class="property-item">
                <strong>Build Reference:</strong>
                <a href="#" id="buildReferenceLink" target="_blank" class="prominent"><span id="buildReference">111122233.1.2</span></a>
            </div>
            <div class="property-item">
                <strong>Timestamp:</strong>
                <span id="timestamp">2025-05-22T09:30:00Z</span>
            </div>
            <div class="property-item">
                <strong>Maturity:</strong>
                <span id="maturity">Snapshot</span>
            </div>
            <div class="property-item">
                <strong>Type:</strong>
                <span id="type" class="prominent">API</span>
            </div>
        </div>
    </section>

    <section class="report-section">
        <h2>Source & Workflow</h2>
        <div class="grid-container">
            <div class="property-item">
                <strong>Repository:</strong>
                <a href="#" id="repositoryLink" target="_blank" class="prominent"><span id="repository">dpe-hello-world</span></a>
            </div>
            <div class="property-item">
                <strong>Branch:</strong>
                <span id="branch">main</span>
                (<span id="protectedBranch" class="status-protected">Yes</span>)
            </div>
            <div class="property-item">
                <strong>Revision:</strong>
                <a href="#" id="revisionLink" target="_blank"><span id="revision">abcdef1234567890</span></a>
            </div>
            <div class="property-item">
                <strong>Workflow:</strong>
                <a href="#" id="workflowLink" target="_blank"><span id="workflow">build-and-deploy.yml</span></a>
            </div>
            <div class="property-item">
                <strong>Actor:</strong>
                <span id="actor">mylogin</span>
            </div>
            <div class="property-item">
                <strong>Runner:</strong>
                <span id="runner">org-runner-2</span>
            </div>
        </div>
    </section>

    <section class="report-section">
        <h2>Project Details</h2>
        <div class="grid-container">
            <div class="property-item">
                <strong>Project ID:</strong>
                <span id="projectId">hello-world</span>
            </div>
            <div class="property-item optional-item" id="projectCodeContainer" style="display: none;">
                <strong>Project Code:</strong>
                <span id="projectCode">hello</span>
            </div>
            <div class="property-item">
                <strong>Application ID:</strong>
                <span id="applicationId">samples</span>
            </div>
            <div class="property-item optional-item" id="applicationIDIPContainer" style="display: none;"> <strong>Application IDIP:</strong>
                <span id="applicationIDIP">SAMPLES</span>
            </div>
            <div class="property-item optional-item" id="platformContainer" style="display: none;">
                <strong>Platform:</strong>
                <span id="platform">Java</span>
            </div>
            <div class="property-item optional-item" id="languagesContainer" style="display: none;"> <strong>Languages:</strong>
                <span id="languages">Java, Dockerfile, Shell</span>
            </div>
            <div class="property-item optional-item" id="buildSystemContainer" style="display: none;"> <strong>Build System:</strong>
                <span id="buildSystem">gradle</span>
            </div>
            <div class="property-item optional-item" id="deliveryContainer" style="display: none;"> <strong>Delivery:</strong>
                <span id="delivery">Kubernetes (Helm) [namespace]</span>
            </div>
        </div>
    </section>

    <section class="report-section">
        <h2>Team & Organisation</h2>
        <div class="grid-container">
            <div class="property-item">
                <strong>Organisation:</strong>
                <a href="#" id="organisationLink" target="_blank"><span id="organisation">myorg</span></a>
            </div>
            <div class="property-item">
                <strong>Team:</strong>
                <a href="#" id="teamLink" target="_blank"><span id="teamCode">DPE</span></a> (<span id="teamSlug">development-platform-engineering</span>)
            </div>
            <div class="property-item">
                <strong>Collaborators:</strong>
                <span id="collaborators">development-platform-engineering, another-team</span>
            </div>
        </div>
    </section>

    <section class="report-section" id="integrationsSection" style="display: none;">
        <h2>Integrations</h2>
        <div class="grid-container">
            <div class="property-item optional-item" id="issueTrackingContainer" style="display: none;"> <strong>Issue Tracking (Jira):</strong>
                <a href="#" id="issueTrackingLink" target="_blank"><span id="issueTracking">HLO</span></a>
            </div>
            <div class="property-item optional-item" id="changeManagementContainer" style="display: none;"> <strong>Change Management (ServiceNow):</strong>
                <a href="#" id="changeManagementLink" target="_blank"><span id="changeManagement">HelloWorld</span></a>
            </div>
            <div class="property-item optional-item" id="teamCityContainer" style="display: none;">
                <strong>TeamCity Project:</strong>
                <a href="#" id="teamCityLink" target="_blank"><span id="teamCity">Apps_DPE_HelloWorld</span></a>
            </div>
        </div>
    </section>


    <section class="report-section">
        <h2>Build Artefacts</h2>
        <ul class="artefacts-list" id="artefactsList">
            <li>
                <span class="artefact-name">hello-world-1.2.3.jar</span>
                <span class="artefact-type">(Java Archive)</span>
                <a href="#">Download/View</a>
            </li>
            <li>
                <span class="artefact-name">Dockerfile</span>
                <span class="artefact-type">(Docker Instruction File)</span>
                <a href="#">Download/View</a>
            </li>
            <li>
                <span class="artefact-name">coverage-report.html</span>
                <span class="artefact-type">(HTML Report)</span>
                <a href="#">Download/View</a>
            </li>
        </ul>
    </section>

</div>

<script>
    // Basic script to handle optional field visibility and dynamic content
    document.addEventListener('DOMContentLoaded', function() {
        function setText(id, value) {
            const el = document.getElementById(id);
            if (el && value !== null && value !== undefined) el.textContent = value;
        }

        function setLink(id, href, text) {
            const el = document.getElementById(id);
            if (el && href !== null && href !== undefined) {
                el.href = href;
                if (text !== null && text !== undefined) el.textContent = text;
            }
        }

        function setVisibility(containerId, data) {
            const container = document.getElementById(containerId);
            if (container) {
                if (data !== null && data !== undefined && String(data).trim() !== "") {
                    container.style.display = ''; // Show if data exists
                    return true;
                } else {
                    container.style.display = 'none'; // Hide if no data
                    return false;
                }
            }
            return false;
        }

        function updateReportWithData(data) {
            // --- Populate Header ---
            setText('projectName', data.project_name);
            setText('applicationName', data.application_name);
            if (setVisibility('projectDescriptionContainer', data.project_description)) {
                setText('projectDescription', data.project_description);
            }

            // --- Populate Build & Version ---
            setText('buildReference', data.build_reference);
            setLink('buildReferenceLink', `https://github.com/${data.organisation}/${data.repository}/actions/runs/${data.build_reference.split('/').pop()}`, data.build_reference);

            if (setVisibility('versionContainer', data.version)) {
                setText('version', data.version);
                setLink('versionLink', `https://github.com/${data.organisation}/${data.repository}/releases/tag/v${data.version}`, `v${data.version}`);
            }

            const date = new Date(data.timestamp);
            setText('timestamp', date.toLocaleString(undefined, { dateStyle: 'medium', timeStyle: 'long' }));
            setText('maturity', data.maturity);
            setText('type', data.project_type);

            // --- Populate Source & Workflow ---
            setText('repository', data.repository);
            setLink('repositoryLink', `https://github.com/${data.organisation}/${data.repository}`, data.repository);
            setText('branch', data.branch);
            const protectedBranchEl = document.getElementById('protectedBranch');
            if (protectedBranchEl) {
                protectedBranchEl.textContent = data.protected_branch === "Yes" ? "Protected" : "Not Protected";
                protectedBranchEl.className = data.protected_branch === "Yes" ? 'status-protected' : 'status-unprotected';
            }
            setText('revision', data.revision.substring(0, 12) + '...');
            setLink('revisionLink', `https://github.com/${data.organisation}/${data.repository}/commit/${data.revision}`, data.revision.substring(0,12)+'...');
            setText('workflow', data.workflow);
            setLink('workflowLink', `https://github.com/${data.organisation}/${data.repository}/blob/${data.branch}/.github/workflows/${data.workflow}`, data.workflow);
            setText('actor', data.actor);
            setText('runner', data.runner);

            // --- Populate Project Details ---
            setText('projectId', data.project_id);
            if(setVisibility('projectCodeContainer', data.project_code)){
                setText('projectCode', data.project_code);
            }
            setText('applicationId', data.application_id);
            setVisibility('applicationIDIPContainer', data.application_idip) && setText('applicationIDIP', data.application_idip);
            setVisibility('platformContainer', data.platform) && setText('platform', data.platform);
            setVisibility('languagesContainer', data.languages) && setText('languages', data.languages);
            setVisibility('buildSystemContainer', data.build_system) && setText('buildSystem', data.build_system);
            setVisibility('deliveryContainer', data.delivery) && setText('delivery', data.delivery);

            // --- Populate Team & Organisation ---
            setText('organisation', data.organisation);
            setLink('organisationLink', `https://github.com/${data.organisation}`, data.organisation);
            setText('teamCode', data.team_code);
            setLink('teamLink', `https://github.com/orgs/${data.organisation}/teams/${data.team_slug}`, data.team_code);
            setText('teamSlug', data.team_slug);
            setText('collaborators', data.collaborators);

            // --- Populate Integrations (and show section if any are present) ---
            let integrationsVisible = false;
            if (setVisibility('issueTrackingContainer', data.issue_tracking)) {
                setText('issueTracking', data.issue_tracking);
                setLink('issueTrackingLink', `https://jira.example.com/browse/${data.issue_tracking}`, data.issue_tracking);
                integrationsVisible = true;
            }
            if (setVisibility('changeManagementContainer', data.change_management)) {
                setText('changeManagement', data.change_management);
                setLink('changeManagementLink', `https://servicenow.example.com/nav_to.do?uri=task.do?sysparm_query=number=${data.change_management}`, data.change_management);
                integrationsVisible = true;
            }
             if (setVisibility('teamCityContainer', data.team_city)) {
                setText('teamCity', data.team_city);
                setLink('teamCityLink', `https://teamcity.example.com/viewType.html?buildTypeId=${data.team_city}`, data.team_city);
                integrationsVisible = true;
            }

            const integrationsSection = document.getElementById('integrationsSection');
            if (integrationsSection && integrationsVisible) {
                integrationsSection.style.display = '';
            }

            // --- Populate Artefacts ---
            const artefactsList = document.getElementById('artefactsList');
            if (artefactsList && data.artifacts) {
                artefactsList.innerHTML = ''; // Clear static examples
                data.artifacts.forEach(artefact => {
                    const li = document.createElement('li');
                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'artefact-name';
                    nameSpan.textContent = artefact.name;
                    li.appendChild(nameSpan);

                    const typeSpan = document.createElement('span');
                    typeSpan.className = 'artefact-type';
                    typeSpan.textContent = `(${artefact.type})`;
                    li.appendChild(typeSpan);

                    const link = document.createElement('a');
                    link.href = artefact.url;
                    link.textContent = 'Download/View';
                    link.target = '_blank'; // Open in new tab
                    li.appendChild(link);
                    artefactsList.appendChild(li);
                });
            }
        }

        // Fetch the JSON data file
        fetch('build-report-data.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to load build report data');
                }
                return response.json();
            })
            .then(data => {
                updateReportWithData(data);
            })
            .catch(error => {
                console.error('Error loading build report data:', error);
            });
    });
</script>

</body>
</html>
